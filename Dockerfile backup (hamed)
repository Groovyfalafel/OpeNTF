
# NV_GPU=1 docker run --gpus '"device=7"' --rm -tid --mount type=bind,source=/gpuhome/hfani/kap/OpeNTF,target=/usr/OpeNTF --name kap cs01/hamed/osprey2


FROM nvidia/cuda:11.1.1-devel-centos7

RUN yum install -y curl bzip2

RUN curl -Ls https://micro.mamba.pm/api/micromamba/linux-64/latest | tar -xvj bin/micromamba && micromamba shell init --shell=bash --prefix=~/micromamba

ENV PATH=$CONDA_DIR/bin:$PATH

COPY ./environment.yml /opt/environment.yml

RUN micromamba create -n kapnmt --file /opt/environment.yml && eval "$(micromamba shell hook --shell=bash)"
RUN micromamba shell init --shell=bash --prefix=~/micromamba

ENV PATH=/root/micromamba/envs/kapnmt/bin:$PATH

# Set the working directory
WORKDIR /OpeNTF


# Set entrypoint
ENTRYPOINT ["/bin/bash"]
